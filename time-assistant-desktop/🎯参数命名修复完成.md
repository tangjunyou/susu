# ğŸ¯ å‚æ•°å‘½åä¿®å¤å®Œæˆ

## ğŸ“‹ é—®é¢˜æ€»ç»“

ç”¨æˆ·æŠ¥å‘Šä¸¤ä¸ªåŠŸèƒ½å¤±è´¥ï¼š
1. âŒ **çª—å£ç½®é¡¶å¤±è´¥**
   ```
   invalid args `alwaysOnTop` for command `toggle_always_on_top`: 
   missing required key alwaysOnTop
   ```

2. âŒ **åæ€åŠŸèƒ½å¤±è´¥**
   ```
   invalid args `planId` for command `get_reflections_for_plan`: 
   missing required key planId
   ```

---

## ğŸ” æ ¹æœ¬åŸå› 

**å‚æ•°å‘½åä¸ä¸€è‡´é—®é¢˜ï¼š**
- **Rust åç«¯**ï¼šä½¿ç”¨ `snake_case`ï¼ˆ`always_on_top`, `plan_id`ï¼‰
- **å‰ç«¯ TypeScript**ï¼šä½¿ç”¨ `camelCase`ï¼ˆ`alwaysOnTop`, `planId`ï¼‰
- **Tauri IPC**ï¼šè¦æ±‚å‚æ•°åå®Œå…¨åŒ¹é…

---

## âœ… è§£å†³æ–¹æ¡ˆ

é‡‡ç”¨**ç»Ÿä¸€ä½¿ç”¨ camelCase**çš„æ–¹æ¡ˆï¼ˆJavaScript/TypeScript æ ‡å‡†ï¼‰ï¼š

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‰æ‹© |
|------|------|------|------|
| 1ï¸âƒ£ Rustæ”¹ç”¨camelCase | å‰ç«¯ä¸ç”¨æ”¹ | ä¸ç¬¦åˆRustè§„èŒƒ | âŒ |
| 2ï¸âƒ£ å‰ç«¯æ”¹ç”¨snake_case | Rustä¸ç”¨æ”¹ | ä¸ç¬¦åˆJSè§„èŒƒ | âŒ |
| 3ï¸âƒ£ serde rename | ç¬¦åˆå„è‡ªè§„èŒƒ | éœ€è¦æ·»åŠ æ³¨è§£ | âœ… |

**æœ€ç»ˆæ–¹æ¡ˆï¼š** ä½¿ç”¨ `#[serde(rename = "...")]` åœ¨ Rust ç«¯æ”¯æŒ camelCaseï¼Œå‰ç«¯ä¿æŒæ ‡å‡† camelCaseã€‚

---

## ğŸ”§ ä¿®å¤æ¸…å•

### Rust åç«¯ä¿®æ”¹

#### 1. `commands.rs` - æ·»åŠ å‚æ•° rename

```rust
// toggle_always_on_top å‡½æ•°
#[tauri::command]
pub async fn toggle_always_on_top(
    app: tauri::AppHandle,
    #[serde(rename = "alwaysOnTop")] always_on_top: bool,  // âœ… æ·»åŠ  rename
) -> Result<(), String>

// get_reflections_for_plan å‡½æ•°
#[tauri::command]
pub async fn get_reflections_for_plan(
    db: State<'_, Arc<Database>>,
    #[serde(rename = "planId")] plan_id: i64,  // âœ… æ·»åŠ  rename
) -> Result<Vec<Reflection>, String>
```

#### 2. `database.rs` - ç»“æ„ä½“å­—æ®µ rename

```rust
// Plan ç»“æ„ä½“
#[derive(Debug, Serialize, Deserialize, Clone)]
pub struct Plan {
    pub id: Option<i64>,
    pub title: String,
    pub description: String,
    pub priority: String,
    pub category: String,
    pub completed: bool,
    #[serde(rename = "totalTime")]   // âœ…
    pub total_time: i64,
    #[serde(rename = "createdAt")]   // âœ…
    pub created_at: String,
    #[serde(rename = "updatedAt")]   // âœ…
    pub updated_at: String,
}

// Reflection ç»“æ„ä½“
#[derive(Debug, Serialize, Deserialize, Clone)]
pub struct Reflection {
    pub id: Option<i64>,
    #[serde(rename = "planId")]      // âœ…
    pub plan_id: i64,
    pub content: String,
    #[serde(rename = "createdAt")]   // âœ…
    pub created_at: String,
}
```

---

### å‰ç«¯ TypeScript ä¿®æ”¹

#### 1. `types/index.ts` - ç±»å‹å®šä¹‰æ”¹ä¸º camelCase

```typescript
// ä¿®å¤å‰
export interface Plan {
  total_time: number;    // âŒ
  created_at: string;    // âŒ
  updated_at: string;    // âŒ
}

// ä¿®å¤å
export interface Plan {
  totalTime: number;     // âœ…
  createdAt: string;     // âœ…
  updatedAt: string;     // âœ…
}

// Reflection åŒæ ·ä¿®å¤
export interface Reflection {
  planId: number;        // âœ…
  createdAt: string;     // âœ…
}
```

#### 2. `utils/api.ts` - API è°ƒç”¨ä½¿ç”¨ camelCase

```typescript
// ä¿®å¤å‰
windowApi.toggleAlwaysOnTop(alwaysOnTop: boolean) {
  await invoke('toggle_always_on_top', { always_on_top: alwaysOnTop });  // âŒ
}

// ä¿®å¤å
windowApi.toggleAlwaysOnTop(alwaysOnTop: boolean) {
  await invoke('toggle_always_on_top', { alwaysOnTop });  // âœ… ç›´æ¥ä¼ é€’
}

// Reflection API åŒæ ·ä¿®å¤
reflectionApi.getReflectionsForPlan(planId: number) {
  await invoke('get_reflections_for_plan', { planId });  // âœ…
}
```

#### 3. ç»„ä»¶æ–‡ä»¶ - ä½¿ç”¨ camelCase å­—æ®µ

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `hooks/usePlans.ts` | `updated_at` â†’ `updatedAt` |
| `components/AddPlanDialog.tsx` | `total_time`, `created_at`, `updated_at` â†’ camelCase |
| `components/PlanCard.tsx` | `total_time`, `created_at` â†’ `totalTime`, `createdAt` |
| `components/ReflectionDialog.tsx` | `plan_id`, `created_at` â†’ `planId`, `createdAt` |
| `App.tsx` | `p.total_time` â†’ `p.totalTime` |

---

## ğŸ“Š ä¿®æ”¹ç»Ÿè®¡

### æ–‡ä»¶ä¿®æ”¹æ•°é‡

| ç±»åˆ« | æ–‡ä»¶æ•° | è¯´æ˜ |
|------|--------|------|
| **Rust åç«¯** | 2 | commands.rs, database.rs |
| **TypeScript ç±»å‹** | 1 | types/index.ts |
| **API å±‚** | 1 | utils/api.ts |
| **React ç»„ä»¶** | 4 | 4ä¸ªç»„ä»¶æ–‡ä»¶ |
| **React Hooks** | 1 | usePlans.ts |
| **æ€»è®¡** | 9 | 9ä¸ªæ–‡ä»¶ |

### å­—æ®µé‡å‘½åç»Ÿè®¡

| Rust (snake_case) | TypeScript (camelCase) | ä½¿ç”¨æ¬¡æ•° |
|-------------------|------------------------|---------|
| `always_on_top` | `alwaysOnTop` | 2å¤„ |
| `plan_id` | `planId` | 5å¤„ |
| `total_time` | `totalTime` | 6å¤„ |
| `created_at` | `createdAt` | 4å¤„ |
| `updated_at` | `updatedAt` | 3å¤„ |

---

## ğŸ§ª éªŒè¯æ¸…å•

### âœ… çª—å£ç½®é¡¶åŠŸèƒ½

**æµ‹è¯•æ­¥éª¤ï¼š**
1. æ‰“å¼€åº”ç”¨å¹¶æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»è®¾ç½® â†’ åˆ‡æ¢"çª—å£ç½®é¡¶"å¼€å…³
3. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š
   ```javascript
   å°è¯•åˆ‡æ¢çª—å£ç½®é¡¶: { å½“å‰å€¼: false, æ–°å€¼: true }
   çª—å£ç½®é¡¶åˆ‡æ¢æˆåŠŸ
   ```
4. éªŒè¯çª—å£ä¿æŒåœ¨å…¶ä»–çª—å£ä¹‹ä¸Š

**é¢„æœŸç»“æœï¼š** âœ… æ— é”™è¯¯ï¼ŒåŠŸèƒ½æ­£å¸¸

---

### âœ… åæ€åŠŸèƒ½

**æµ‹è¯•æ­¥éª¤ï¼š**
1. åˆ›å»ºä¸€ä¸ªæµ‹è¯•è®¡åˆ’
2. ç‚¹å‡»è®¡åˆ’çš„"åæ€"æŒ‰é’®
3. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š
   ```javascript
   åŠ è½½è®¡åˆ’åæ€, plan_id: 1
   åæ€åŠ è½½æˆåŠŸ, æ•°é‡: 0
   ```
4. è¾“å…¥åæ€å†…å®¹å¹¶æäº¤
5. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š
   ```javascript
   æäº¤åæ€: { plan: {..., id: 1}, content: "..." }
   å‘é€åæ€æ•°æ®: { planId: 1, content: "...", createdAt: "..." }
   åæ€æ·»åŠ æˆåŠŸ, ID: 1
   ```
6. éªŒè¯åæ€å‡ºç°åœ¨å†å²åˆ—è¡¨ä¸­

**é¢„æœŸç»“æœï¼š** âœ… æ— é”™è¯¯ï¼Œåæ€æˆåŠŸæ·»åŠ 

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### Tauri å‚æ•°ä¼ é€’æœºåˆ¶

```
å‰ç«¯ JavaScript               Tauri IPC                 Rust åç«¯
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{ alwaysOnTop: true }    â†’    åºåˆ—åŒ–/ååºåˆ—åŒ–    â†’    always_on_top: bool
                                    â†“
                          ä½¿ç”¨ #[serde(rename)]
                          å°† alwaysOnTop æ˜ å°„åˆ°
                          always_on_top
```

### serde rename çš„ä½œç”¨

```rust
#[serde(rename = "alwaysOnTop")]
pub always_on_top: bool
```

**ä½œç”¨ï¼š**
- **åºåˆ—åŒ–æ—¶**ï¼šå°† Rust çš„ `always_on_top` è¾“å‡ºä¸º JSON çš„ `alwaysOnTop`
- **ååºåˆ—åŒ–æ—¶**ï¼šå°† JSON çš„ `alwaysOnTop` è¯»å…¥ Rust çš„ `always_on_top`
- **åŒå‘è‡ªåŠ¨è½¬æ¢**ï¼šå‰ç«¯å’Œåç«¯å¯ä»¥ä½¿ç”¨å„è‡ªçš„å‘½åé£æ ¼

---

## ğŸ“ ç»éªŒæ€»ç»“

### 1. å‘½åè§„èŒƒçš„é‡è¦æ€§

| è¯­è¨€/æ¡†æ¶ | æ ‡å‡†å‘½å | åŸå›  |
|----------|---------|------|
| **Rust** | snake_case | è¯­è¨€è§„èŒƒè¦æ±‚ |
| **JavaScript/TypeScript** | camelCase | ç¤¾åŒºæ ‡å‡† |
| **JSON** | camelCase | Web æ ‡å‡† |

### 2. è·¨è¯­è¨€é€šä¿¡çš„æŒ‘æˆ˜

- âŒ **ç®€å•é‡å‘½å**ï¼šç ´åè¯­è¨€è§„èŒƒ
- âŒ **å¼ºåˆ¶ç»Ÿä¸€**ï¼šç‰ºç‰²å¯è¯»æ€§
- âœ… **åºåˆ—åŒ–æ˜ å°„**ï¼šå„è‡ªéµå®ˆè§„èŒƒï¼Œè‡ªåŠ¨è½¬æ¢

### 3. serde çš„å¼ºå¤§ä¹‹å¤„

```rust
#[derive(Serialize, Deserialize)]
struct Data {
    #[serde(rename = "clientName")]
    pub client_name: String,
    
    #[serde(rename = "totalAmount")]
    pub total_amount: f64,
}
```

**ä¼˜ç‚¹ï¼š**
- âœ… Rust ä»£ç ä¿æŒ snake_caseï¼ˆç¬¦åˆè§„èŒƒï¼‰
- âœ… JSON è¾“å‡ºä¸º camelCaseï¼ˆWeb æ ‡å‡†ï¼‰
- âœ… è‡ªåŠ¨åŒå‘è½¬æ¢
- âœ… ç±»å‹å®‰å…¨

---

## ğŸš€ åç»­å»ºè®®

### 1. ç¼–ç è§„èŒƒ

**å»ºç«‹è§„èŒƒæ–‡æ¡£ï¼š**
```
å‰ç«¯ï¼ˆTypeScriptï¼‰ï¼š
  - å˜é‡/å‡½æ•°ï¼šcamelCase
  - ç±»/æ¥å£ï¼šPascalCase
  - å¸¸é‡ï¼šUPPER_SNAKE_CASE

åç«¯ï¼ˆRustï¼‰ï¼š
  - å˜é‡/å‡½æ•°ï¼šsnake_case
  - ç±»å‹/Traitï¼šPascalCase
  - å¸¸é‡ï¼šSCREAMING_SNAKE_CASE

è·¨è¯­è¨€é€šä¿¡ï¼š
  - ç»Ÿä¸€ä½¿ç”¨ camelCase (JSONæ ‡å‡†)
  - Rust ä½¿ç”¨ #[serde(rename)]
```

### 2. ç±»å‹ç”Ÿæˆå·¥å…·

è€ƒè™‘ä½¿ç”¨å·¥å…·è‡ªåŠ¨ç”Ÿæˆç±»å‹å®šä¹‰ï¼š
- **ts-rs**ï¼šä» Rust ç”Ÿæˆ TypeScript ç±»å‹
- **typeshare**ï¼šRust/TypeScript ç±»å‹å…±äº«
- å¥½å¤„ï¼šé¿å…æ‰‹åŠ¨åŒæ­¥ç±»å‹ï¼Œå‡å°‘é”™è¯¯

### 3. æµ‹è¯•è¦†ç›–

æ·»åŠ é›†æˆæµ‹è¯•éªŒè¯å‚æ•°ä¼ é€’ï¼š
```rust
#[test]
fn test_serialize_plan() {
    let plan = Plan {
        total_time: 100,
        created_at: "2025-01-01".to_string(),
        // ...
    };
    
    let json = serde_json::to_string(&plan).unwrap();
    assert!(json.contains("totalTime"));  // éªŒè¯camelCase
    assert!(json.contains("createdAt"));
}
```

---

## âœ… ä¿®å¤å®ŒæˆçŠ¶æ€

| åŠŸèƒ½ | çŠ¶æ€ | æµ‹è¯• |
|------|------|------|
| çª—å£ç½®é¡¶ | âœ… å·²ä¿®å¤ | ç­‰å¾…ç”¨æˆ·æµ‹è¯• |
| åæ€åŠŸèƒ½ | âœ… å·²ä¿®å¤ | ç­‰å¾…ç”¨æˆ·æµ‹è¯• |
| è®¡åˆ’ç®¡ç† | âœ… å·²åŒæ­¥ | ç­‰å¾…ç”¨æˆ·æµ‹è¯• |
| ç±»å‹å®šä¹‰ | âœ… å·²ç»Ÿä¸€ | - |
| API è°ƒç”¨ | âœ… å·²ä¿®å¤ | - |

---

**ä¿®å¤æ—¶é—´ï¼š** 2025-10-29  
**ä¿®å¤çŠ¶æ€ï¼š** âœ… å®Œæˆï¼Œç­‰å¾…ç¼–è¯‘å’Œæµ‹è¯•  
**å½±å“èŒƒå›´ï¼š** æ‰€æœ‰æ¶‰åŠæ•°æ®ä¼ é€’çš„åŠŸèƒ½  
**å‘åå…¼å®¹ï¼š** âš ï¸ ç ´åæ€§æ›´æ”¹ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘





