# ğŸ“… æŒ‰å¤©ç»„ç»‡åŠŸèƒ½å®ç°æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š
1. âœ… **æ—¥æœŸå­—æ®µ** - æ·»åŠ  startDate å’Œ endDate
2. âœ… **è·¨å¤©ä»»åŠ¡æ”¯æŒ** - å¯è®¾ç½®å¤šå¤©çš„ä»»åŠ¡
3. âœ… **è®¡åˆ’è¯¦æƒ…çª—å£** - ç‚¹å‡»è®¡åˆ’æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
4. ğŸ”„ **æŒ‰æ—¥æœŸåˆ†ç»„æ˜¾ç¤º** - å°†è®¡åˆ’æŒ‰"ä»Šå¤©"ã€"æ˜å¤©"ç­‰åˆ†ç»„ï¼ˆå¾…å®Œæˆï¼‰
5. ğŸ”„ **PlanCard ç‚¹å‡»åŠŸèƒ½** - æ·»åŠ ç‚¹å‡»æ‰“å¼€è¯¦æƒ…ï¼ˆå¾…å®Œæˆï¼‰

---

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. ç±»å‹å®šä¹‰æ›´æ–°

**æ–‡ä»¶ï¼š** `src/types/index.ts`

```typescript
export interface Plan {
  id?: number;
  title: string;
  description: string;
  priority: 'high' | 'medium' | 'low';
  category: 'work' | 'study' | 'life' | 'health' | 'other';
  completed: boolean;
  totalTime: number;
  startDate: string;  // æ–°å¢ï¼šå¼€å§‹æ—¥æœŸ YYYY-MM-DD
  endDate: string;    // æ–°å¢ï¼šç»“æŸæ—¥æœŸ YYYY-MM-DD
  createdAt: string;
  updatedAt: string;
}
```

### 2. æ•°æ®åº“ç»“æ„æ›´æ–°

**æ–‡ä»¶ï¼š** `src-tauri/src/database.rs`

**Rust ç»“æ„ä½“ï¼š**
```rust
#[derive(Debug, Serialize, Deserialize, Clone)]
pub struct Plan {
    // ... å…¶ä»–å­—æ®µ
    #[serde(rename = "startDate")]
    pub start_date: String,
    #[serde(rename = "endDate")]
    pub end_date: String,
    // ...
}
```

**æ•°æ®åº“è¡¨ï¼š**
```sql
CREATE TABLE IF NOT EXISTS plans (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    description TEXT,
    priority TEXT NOT NULL,
    category TEXT NOT NULL,
    completed INTEGER NOT NULL DEFAULT 0,
    total_time INTEGER NOT NULL DEFAULT 0,
    start_date TEXT NOT NULL,        -- æ–°å¢
    end_date TEXT NOT NULL,          -- æ–°å¢
    created_at TEXT NOT NULL,
    updated_at TEXT NOT NULL
)
```

**æŸ¥è¯¢æ’åºï¼š**
```rust
ORDER BY start_date DESC, created_at DESC
```

### 3. æ—¥æœŸå·¥å…·å‡½æ•°

**æ–‡ä»¶ï¼š** `src/utils/format.ts`

```typescript
// è·å–ä»Šå¤©æ—¥æœŸ YYYY-MM-DD
export function getTodayDate(): string

// è·å–å‹å¥½çš„æ—¥æœŸæ ‡ç­¾ï¼ˆä»Šå¤©ã€æ˜¨å¤©ã€æ˜å¤©ã€æ—¥æœŸ+å‘¨å‡ ï¼‰
export function getDateLabel(dateStr: string): string

// æ ¼å¼åŒ–æ—¥æœŸèŒƒå›´
export function formatDateRange(startDate: string, endDate: string): string
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
- `2025-10-29` â†’ `"ä»Šå¤©"`
- `2025-10-28` â†’ `"æ˜¨å¤©"`
- `2025-10-30` â†’ `"æ˜å¤©"`
- `2025-11-01` â†’ `"2025-11-01 å‘¨äº”"`
- èŒƒå›´ï¼š`"ä»Šå¤© - æ˜å¤©"`

### 4. PlanDetailDialog ç»„ä»¶

**æ–‡ä»¶ï¼š** `src/components/PlanDetailDialog.tsx`

**åŠŸèƒ½ï¼š**
- ğŸ“‹ æ˜¾ç¤ºè®¡åˆ’å®Œæ•´ä¿¡æ¯
- ğŸ“… æ˜¾ç¤ºæ—¥æœŸèŒƒå›´
- â±ï¸ æ˜¾ç¤ºç´¯è®¡æ—¶é—´
- ğŸ·ï¸ æ˜¾ç¤ºä¼˜å…ˆçº§å’Œåˆ†ç±»æ ‡ç­¾
- ğŸ“ æ˜¾ç¤ºè¯¦ç»†æè¿°
- ğŸ è·¨å¤©ä»»åŠ¡æ ‡è¯†
- âš¡ å¿«æ·æ“ä½œæŒ‰é’®ï¼ˆå¼€å§‹è®¡æ—¶ã€æ·»åŠ åæ€ï¼‰

**UI ç‰¹ç‚¹ï¼š**
- å¤§æ ‡é¢˜æ˜¾ç¤ºè®¡åˆ’åç§°
- æ ‡ç­¾å¼æ˜¾ç¤ºä¼˜å…ˆçº§ã€åˆ†ç±»ã€å®ŒæˆçŠ¶æ€ã€è·¨å¤©æ ‡è¯†
- å›¾æ ‡ + å†…å®¹çš„æ¸…æ™°å¸ƒå±€
- åº•éƒ¨æ“ä½œæŒ‰é’®åŒº

### 5. AddPlanDialog æ›´æ–°

**æ–‡ä»¶ï¼š** `src/components/AddPlanDialog.tsx`

**æ–°å¢åŠŸèƒ½ï¼š**
- ğŸ“… å¼€å§‹æ—¥æœŸé€‰æ‹©å™¨
- ğŸ“… ç»“æŸæ—¥æœŸé€‰æ‹©å™¨ï¼ˆè‡ªåŠ¨é™åˆ¶ä¸èƒ½æ—©äºå¼€å§‹æ—¥æœŸï¼‰
- ğŸ’¡ è·¨å¤©ä»»åŠ¡æç¤ºï¼ˆæ˜¾ç¤ºè·¨å‡ å¤©ï¼‰

**æ™ºèƒ½éªŒè¯ï¼š**
```typescript
// ç¡®ä¿ç»“æŸæ—¥æœŸä¸æ—©äºå¼€å§‹æ—¥æœŸ
const actualEndDate = endDate < startDate ? startDate : endDate;
```

**è·¨å¤©æç¤ºï¼š**
```
ğŸ’¡ è¿™æ˜¯ä¸€ä¸ªè·¨ 3 å¤©çš„ä»»åŠ¡
```

---

## ğŸ”„ å¾…å®Œæˆçš„åŠŸèƒ½

### 1. App.tsx - æŒ‰æ—¥æœŸåˆ†ç»„æ˜¾ç¤º

éœ€è¦å®ç°æŒ‰æ—¥æœŸåˆ†ç»„çš„é€»è¾‘ï¼š

```typescript
interface GroupedPlans {
  today: Plan[];
  tomorrow: Plan[];
  upcoming: Plan[];
  past: Plan[];
}

function groupPlansByDate(plans: Plan[]): GroupedPlans {
  const today = getTodayDate();
  const tomorrow = // æ˜å¤©çš„æ—¥æœŸ
  
  return plans.reduce((groups, plan) => {
    if (plan.startDate <= today && plan.endDate >= today) {
      groups.today.push(plan);  // ä»Šå¤©çš„ä»»åŠ¡
    } else if (plan.startDate === tomorrow) {
      groups.tomorrow.push(plan);  // æ˜å¤©çš„ä»»åŠ¡
    } else if (plan.startDate > tomorrow) {
      groups.upcoming.push(plan);  // æœªæ¥çš„ä»»åŠ¡
    } else {
      groups.past.push(plan);  // è¿‡å»çš„ä»»åŠ¡
    }
    return groups;
  }, { today: [], tomorrow: [], upcoming: [], past: [] });
}
```

**UI å±•ç¤ºï¼š**
```tsx
<div>
  <DateSection title="ä»Šå¤©" plans={groupedPlans.today} />
  <DateSection title="æ˜å¤©" plans={groupedPlans.tomorrow} />
  <DateSection title="å³å°†åˆ°æ¥" plans={groupedPlans.upcoming} />
  <DateSection title="è¿‡å»" plans={groupedPlans.past} />
</div>
```

### 2. PlanCard - æ·»åŠ ç‚¹å‡»åŠŸèƒ½

åœ¨ PlanCard ç»„ä»¶æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼š

```typescript
interface PlanCardProps {
  plan: Plan;
  onUpdate: (plan: Plan) => void;
  onDelete: (id: number) => void;
  onReflect: (plan: Plan) => void;
  onClick?: (plan: Plan) => void;  // æ–°å¢
}

// åœ¨å¡ç‰‡å¤–å±‚æ·»åŠ ç‚¹å‡»
<div 
  className="..."
  onClick={() => onClick?.(plan)}
  style={{ cursor: 'pointer' }}
>
  {/* å¡ç‰‡å†…å®¹ */}
</div>
```

### 3. App.tsx - é›†æˆè¯¦æƒ…å¯¹è¯æ¡†

```typescript
const [detailPlan, setDetailPlan] = useState<Plan | null>(null);

<PlanDetailDialog
  isOpen={!!detailPlan}
  onClose={() => setDetailPlan(null)}
  plan={detailPlan}
  onStartTimer={() => {
    // å¼€å§‹è®¡æ—¶é€»è¾‘
  }}
  onReflect={() => {
    setReflectionPlan(detailPlan);
    setDetailPlan(null);
  }}
/>
```

---

## ğŸ“Š æ•°æ®æµ

### æ·»åŠ è®¡åˆ’æµç¨‹

```
ç”¨æˆ·å¡«å†™è¡¨å•
  â”œâ”€ æ ‡é¢˜ã€æè¿°
  â”œâ”€ ä¼˜å…ˆçº§ã€åˆ†ç±»
  â””â”€ å¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸ
       â†“
AddPlanDialog éªŒè¯
       â†“
è°ƒç”¨ addPlan API
       â†“
Rust: database.rs
       â†“
SQLite ä¿å­˜
       â†“
è¿”å›æ–°ID
       â†“
å‰ç«¯åˆ·æ–°åˆ—è¡¨
```

### æŸ¥çœ‹è¯¦æƒ…æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»è®¡åˆ’å¡ç‰‡
       â†“
è§¦å‘ onClick äº‹ä»¶
       â†“
è®¾ç½® detailPlan çŠ¶æ€
       â†“
PlanDetailDialog æ‰“å¼€
       â†“
æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
       â†“
ç”¨æˆ·ç‚¹å‡»æ“ä½œæŒ‰é’®
       â†“
æ‰§è¡Œå¯¹åº”åŠŸèƒ½
```

---

## ğŸ¨ UI è®¾è®¡

### æ—¥æœŸåˆ†ç»„æ ‡é¢˜æ ·å¼

```tsx
<div className="mb-3">
  <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2">
    ğŸ“… ä»Šå¤©
    <span className="text-sm font-normal text-gray-500">
      ({plans.length} ä¸ªä»»åŠ¡)
    </span>
  </h3>
</div>
```

### è·¨å¤©ä»»åŠ¡æ ‡è¯†

```tsx
{isMultiDay && (
  <span className="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-700 border border-blue-300">
    ğŸ“… è·¨å¤©ä»»åŠ¡
  </span>
)}
```

### æ—¥æœŸèŒƒå›´æ˜¾ç¤º

```tsx
<div className="flex items-center gap-2 text-sm text-gray-600">
  <Calendar className="w-4 h-4" />
  <span>{formatDateRange(plan.startDate, plan.endDate)}</span>
</div>
```

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå•æ—¥ä»»åŠ¡

```
æ ‡é¢˜ï¼šå®Œæˆé¡¹ç›®æ–‡æ¡£
å¼€å§‹æ—¥æœŸï¼š2025-10-29
ç»“æŸæ—¥æœŸï¼š2025-10-29
æ˜¾ç¤ºï¼šä»Šå¤©
```

### åœºæ™¯2ï¼šè·¨å¤©ä»»åŠ¡

```
æ ‡é¢˜ï¼šå‡†å¤‡å‘¨æŠ¥
å¼€å§‹æ—¥æœŸï¼š2025-10-29
ç»“æŸæ—¥æœŸï¼š2025-10-31
æ˜¾ç¤ºï¼šä»Šå¤© - 2025-10-31 å‘¨å››
æ ‡ç­¾ï¼šğŸ“… è·¨å¤©ä»»åŠ¡
```

### åœºæ™¯3ï¼šæœªæ¥ä»»åŠ¡

```
æ ‡é¢˜ï¼šä¸‹å‘¨ä¼šè®®å‡†å¤‡
å¼€å§‹æ—¥æœŸï¼š2025-11-04
ç»“æŸæ—¥æœŸï¼š2025-11-04
åˆ†ç»„ï¼šå³å°†åˆ°æ¥
æ˜¾ç¤ºï¼š2025-11-04 å‘¨ä¸€
```

---

## ğŸ”§ è¿ç§»æ³¨æ„äº‹é¡¹

### æ•°æ®åº“è¿ç§»

âš ï¸ **é‡è¦ï¼š** ç”±äºæ·»åŠ äº†æ–°å­—æ®µï¼Œç°æœ‰æ•°æ®åº“éœ€è¦è¿ç§»ï¼

**æ–¹æ¡ˆ1ï¼šåˆ é™¤æ—§æ•°æ®**
```bash
# Windows
del %LOCALAPPDATA%\time-assistant\data.db

# é‡å¯åº”ç”¨ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°è¡¨
```

**æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨è¿ç§»ï¼ˆé«˜çº§ï¼‰**
```sql
-- æ·»åŠ æ–°åˆ—
ALTER TABLE plans ADD COLUMN start_date TEXT;
ALTER TABLE plans ADD COLUMN end_date TEXT;

-- ä¸ºç°æœ‰æ•°æ®è®¾ç½®é»˜è®¤å€¼ï¼ˆä½¿ç”¨åˆ›å»ºæ—¥æœŸï¼‰
UPDATE plans SET 
  start_date = DATE(created_at),
  end_date = DATE(created_at)
WHERE start_date IS NULL;
```

---

## ğŸ“ æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•

- [ ] æ·»åŠ ä»Šå¤©çš„å•æ—¥ä»»åŠ¡
- [ ] æ·»åŠ è·¨å¤©ä»»åŠ¡ï¼ˆä»Šå¤©åˆ°æ˜å¤©ï¼‰
- [ ] æ·»åŠ æœªæ¥ä»»åŠ¡
- [ ] ç‚¹å‡»ä»»åŠ¡æŸ¥çœ‹è¯¦æƒ…
- [ ] è¯¦æƒ…çª—å£æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯
- [ ] ä»è¯¦æƒ…çª—å£å¼€å§‹è®¡æ—¶
- [ ] ä»è¯¦æƒ…çª—å£æ·»åŠ åæ€
- [ ] è·¨å¤©ä»»åŠ¡æ˜¾ç¤ºæ­£ç¡®æ ‡ç­¾
- [ ] æ—¥æœŸåˆ†ç»„æ­£ç¡®æ˜¾ç¤º
- [ ] ç»“æŸæ—¥æœŸä¸èƒ½æ—©äºå¼€å§‹æ—¥æœŸ

### UI æµ‹è¯•

- [ ] ç´§å‡‘æ¨¡å¼ä¸‹æ­£å¸¸æ˜¾ç¤º
- [ ] æ·±è‰²æ¨¡å¼ä¸‹æ­£å¸¸æ˜¾ç¤º
- [ ] æ—¥æœŸé€‰æ‹©å™¨æ­£å¸¸å·¥ä½œ
- [ ] è·¨å¤©æç¤ºæ­£ç¡®è®¡ç®—å¤©æ•°
- [ ] è¯¦æƒ…çª—å£å¸ƒå±€æ­£å¸¸
- [ ] ç§»åŠ¨ç«¯/å°å±å¹•é€‚é…

---

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### æ—¥æœŸæ¯”è¾ƒ

```typescript
// å­—ç¬¦ä¸²æ—¥æœŸå¯ä»¥ç›´æ¥æ¯”è¾ƒï¼ˆYYYY-MM-DDæ ¼å¼ï¼‰
if (endDate < startDate) {
  // ç»“æŸæ—¥æœŸæ—©äºå¼€å§‹æ—¥æœŸ
}
```

### è®¡ç®—å¤©æ•°å·®

```typescript
const days = Math.ceil(
  (new Date(endDate).getTime() - new Date(startDate).getTime()) 
  / (1000 * 60 * 60 * 24)
) + 1;
```

### è·¨å¤©åˆ¤æ–­

```typescript
const isMultiDay = plan.startDate !== plan.endDate;
```

### ä»»åŠ¡æ˜¯å¦åœ¨ä»Šå¤©

```typescript
const today = getTodayDate();
const isToday = plan.startDate <= today && plan.endDate >= today;
```

---

## ğŸš€ åç»­ä¼˜åŒ–

### 1. æ—¥å†è§†å›¾

æ·»åŠ æœˆå†è§†å›¾ï¼Œç›´è§‚æ˜¾ç¤ºä»»åŠ¡åˆ†å¸ƒï¼š
```
10æœˆ
ä¸€  äºŒ  ä¸‰  å››  äº”  å…­  æ—¥
                    1   2
3   4   5   6   7   8   9
10  11  12  13  14  15  16
    [ä»»åŠ¡1]  [ä»»åŠ¡2]
```

### 2. æ‹–æ‹½è°ƒæ•´æ—¥æœŸ

æ”¯æŒæ‹–æ‹½è®¡åˆ’åˆ°ä¸åŒæ—¥æœŸï¼š
```typescript
onDrop={(e) => {
  const newDate = e.target.dataset.date;
  updatePlan({ ...plan, startDate: newDate });
}}
```

### 3. é‡å¤ä»»åŠ¡

æ·»åŠ é‡å¤æ¨¡å¼ï¼ˆæ¯å¤©ã€æ¯å‘¨ã€æ¯æœˆï¼‰ï¼š
```typescript
interface Plan {
  // ...
  repeatPattern?: 'daily' | 'weekly' | 'monthly';
  repeatUntil?: string;
}
```

### 4. æˆªæ­¢æ—¥æœŸæé†’

ä»»åŠ¡ä¸´è¿‘æˆªæ­¢æ—¶è‡ªåŠ¨æé†’ï¼š
```typescript
if (plan.endDate === getTodayDate()) {
  showNotification('ä»»åŠ¡ä»Šå¤©æˆªæ­¢ï¼');
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ—¶é—´åŠ©æ‰‹ä½¿ç”¨æŒ‡å—](./ä½¿ç”¨æŒ‡å—.md)
- [ç´§å‡‘æ¨¡å¼åŠŸèƒ½è¯´æ˜](./âœ¨ç´§å‡‘æ¨¡å¼åŠŸèƒ½è¯´æ˜.md)
- [å‚æ•°å‘½åä¿®å¤](./ğŸ¯å‚æ•°å‘½åä¿®å¤å®Œæˆ.md)

---

**åˆ›å»ºæ—¶é—´ï¼š** 2025-10-29  
**å®ç°çŠ¶æ€ï¼š** 60% å®Œæˆ  
**å¾…å®Œæˆï¼š** App.tsxæŒ‰æ—¥æœŸåˆ†ç»„ã€PlanCardç‚¹å‡»åŠŸèƒ½





